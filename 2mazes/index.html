<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>2 mazes</title>
    
	
	 <script src="https://cdn.babylonjs.com/babylon.js"></script>
	 <script src = "https://cdn.babylonjs.com/gui/babylon.gui.js"></script>
	
    <style>
        html, body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
        }
		
		#fps {
		position: absolute;
		background-color: black;
		border:2px solid red;
		text-align:center;
		font-size: 16px;
		color: white;
		top: 15px;
		left: 10px;
		width: 60px;
		height:20px;
		display:block
		}
		
		#DCs {
		position: absolute;
		background-color: black;
		border:2px solid red;
		text-align:center;
		font-size: 16px;
		color: white;
		top: 15px;
		left: 80px;
		width: 60px;
		height: 20px;
		display:block;
		}
		
		#meshes {
		position: absolute;
		background-color: black;
		border:2px solid red;
		text-align:center;
		font-size: 16px;
		color: white;
		top: 50px;
		left: 10px;
		width: 132px;
		height: 20px;
		display:block;
		}
		
		#verts {
		position: absolute;
		background-color: black;
		border:2px solid red;
		text-align:center;
		font-size: 16px;
		color: white;
		top: 85px;
		left: 10px;
		width: 132px;
		height: 20px;
		display:block;
		}
		
		
		#credits {
		position: absolute;
		left:25%;
		top:25px;
		width:50%;
		height: 30px;
		background-color: black;
		line-height: 150%;
		text-align: center;
		font-size: 20px;
		color: white;
		
		}
		
		#music {
		position: absolute;
		left:25%;
		top:90%;
		width:60%;
		height: 30px;
		background-color: black;
		line-height: 150%;
		text-align: center;
		font-size: 16px;
		color: white;
		}
		
		#container {
		width: 700px ;
		margin-left: auto ;
		margin-right: auto ;
		}
		 
		#loader {
		position: absolute;
		background-color: red;
		width: 100%;
        height: 100%;
		text-align: center;
		font-size: 30px;
		color: white;
		display:none;
		}
		
    </style>
</head>
<body>
	<div id = "fps">0</div>
	<div id ="DCs">0</div>
	<div id ="meshes">0</div>
	<div id = "verts">0</div>
<!--
	<div id = "credits">Grant Abbitt's Low-Poly Bridge and Terrain in 3D in a web browser</div>
	
	<div id = "music">Music: "There is Rpmance" Kevin MacLeod (incompetech.com) Licensed under Creative Commons: By Attribution 4.0 License </br> http://creativecommons.org/licenses/by/4.0/</div>
-->
    <canvas id="renderCanvas"></canvas>
    <script>
        if (BABYLON.Engine.isSupported()) {
            var canvas = document.getElementById("renderCanvas");
            var engine = new BABYLON.Engine(canvas, true);
			var myCamera1,myCamera2, myCamera3;
			//var soundsReady = 0;
			var takes = 0;
			//var theVolume =.2;
			var divFps = document.getElementById("fps");
			var divDCs = document.getElementById("DCs");
			var divAllMeshs = document.getElementById("meshes");
			var divVerts = document.getElementById("verts");
			
			var meshFlag;
			var isPlay = 0;
			var pathFlag =0;
			var easyMeshes;
			var hardMeshes;
			var ballCam1;
			var ballCam2;
			
			//var divImage = document.getElementById("credits");
			var myScene = new BABYLON.Scene(engine);
			var sceneInstru = new BABYLON.SceneInstrumentation(myScene);

			
			//append .babylon file to myScene
			BABYLON.SceneLoader.Append("", "maze02_plugin.babylon", myScene);
			
                myScene.executeWhenReady(function () {
				
				
					//change the value of cameraFlag to a value other than 1 to use the free camera from blender
					meshFlag = 1;
					
					// which camera is active BJS Arc Rotate or Blender Camera
					
					myCamera1 = myScene.getCameraByName("Camera1");
					//myCamera1.position.x = -8.67993744699121;
					myCamera1.speed = .1;
					myCamera1.wheelPrecision = 100;
					myCamera1.minZ= 0.01;
					myCamera1.maxZ= 500;
					//myScene.activeCamera = myCamera1;
					
					myCamera2 = myScene.getCameraByName("Camera2");
					myCamera2.speed = .1;
					myCamera2.minZ= 0.01;
					myCamera2.maxZ= 500;
					//myScene.activeCamera = myCamera2;
					
					myCamera3 = myScene.getCameraByName("Camera3");
					myCamera3.speed = .1;
					myCamera3.wheelPrecision = 10;
					myCamera3.minZ= 0.01;
					myCamera3.maxZ= 500;
					myCamera3.lowerBetaLimit = 0.3;
					myCamera3.upperBetaLimit = 0.6;
					myCamera3.lowerRadiusLimit = 30;
					myCamera3.upperRadiusLimit = 40;
					myScene.activeCamera = myCamera3;
					
					ballCam1 = myScene.getMeshByName("cam1ball");
					ballCam1.setParent(myCamera1);
					//myCamera1.addChild
				
					ballCam2 = myScene.getMeshByName("cam2ball");
					ballCam2.setParent(myCamera2);
					ballCam2.isVisible = false;
					//ballCam2.setParent = myCamera2;
				
					
					// Then attach the activeCamera to the canvas.
					myScene.activeCamera.attachControl(canvas);
					
					// get the two mazes
					let theEasy = myScene.getMeshByName("Easy");
					easyMeshes = theEasy.getChildren();
					console.log(easyMeshes.length);
					
					let theHard = myScene.getMeshByName("Hard");
					hardMeshes = theHard.getChildren();
					console.log(hardMeshes.length);
					
					if(meshFlag === 1){
						for(i=0; i<easyMeshes.length; i++){
						
							easyMeshes[i].setEnabled(true);
							hardMeshes[i].setEnabled(false);
							//console.log(easyMeshes[i].name + "   " + hardMeshes[i].name);
						};
					//ballCam2.isVisible = false;
					
					};
					
					easyMeshes[3].isVisible = false;
					hardMeshes[3].isVisible = false;
					//easyMeshes[4].isVisible = true;
					//hardMeshes[4].isVisible = false;
					
					
					
					// create the buttons
					var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");
					var UiPanel = new BABYLON.GUI.StackPanel();
					advancedTexture.addControl(UiPanel);

					const button1 = BABYLON.GUI.Button.CreateSimpleButton("but1", "Maze 1");
					button1.width = "100px"
					button1.height = "40px";
					button1.top = "-10px";
					//button1.top = "10px";
					button1.left = "-520px";
					button1.color = "yellow";
					button1.cornerRadius = 20;
					button1.background = "green";
					button1.fontSize = 20;
					button1.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
							
					advancedTexture.addControl(button1);  
					
					const button2 = BABYLON.GUI.Button.CreateSimpleButton("but1", "Maze 2");
					button2.width = "100px"
					button2.height = "40px";
					button2.top = "-10px";
					//button2.top = "10px";
					button2.left = "-520px";
					button2.color = "yellow";
					button2.cornerRadius = 20;
					button2.background = "green";
					button2.fontSize = 20;
					button2.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
							
					advancedTexture.addControl(button2);
					
					const button3 = BABYLON.GUI.Button.CreateSimpleButton("but1", "Path");
					button3.width = "100px"
					button3.height = "40px";
					button3.top = "-10px";
					//button3.top = "10px";
					button3.left = "520px";
					button3.color = "yellow";
					button3.cornerRadius = 20;
					button3.background = "green";
					button3.fontSize = 20;
					button3.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
							
					advancedTexture.addControl(button3); 

					const button4 = BABYLON.GUI.Button.CreateSimpleButton("but1", "Play");
					button4.width = "100px"
					button4.height = "40px";
					button4.top = "-10px";
					//button4.top = "10px";
					button4.left = "0px";
					button4.color = "yellow";
					button4.cornerRadius = 20;
					button4.background = "green";
					button4.fontSize = 20;
					button4.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
							
					advancedTexture.addControl(button4);  
					
					const button5 = BABYLON.GUI.Button.CreateSimpleButton("but1", "View Maze");
					button5.width = "150px"
					button5.height = "40px";
					button5.top = "-10px";
					//button5.top = "10px";
					button5.left = "0px";
					button5.color = "yellow";
					button5.cornerRadius = 20;
					button5.background = "green";
					button5.fontSize = 20;
					button5.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
							
					advancedTexture.addControl(button5);  



					if(meshFlag === 1){
						button1.isEnabled = false;
						button1.isVisible = false;
						button2.isEnabled = true;
						button2.isVisible = true;
						button4.isEnabled = true;
						button4.isVisible = true;
						button5.isEnabled = false;
						button5.isVisible = false;
					}
					else{
						button1.isEnabled = true;
						button1.isVisible = true;
						button2.isEnabled = false;
						button2.isVisible = false;
						button4.isEnabled = true;
						button4.isVisible = true;
						button5.isEnabled = false;
						button5.isVisible = false;
					
					}

					button1.onPointerUpObservable.add(function() {
					chooseMaze();
					button1.isEnabled = false;
					button1.isVisible = false;
					button2.isEnabled = true;
					button2.isVisible = true;
					ballCam1.isVisible = true;
					ballCam2.isVisible = false;
					//easyMeshes[4].isVisible = !easyMeshes[4].isVisible;
							
					});
					
					button2.onPointerUpObservable.add(function() {
					chooseMaze();
					button1.isEnabled = true;
					button1.isVisible = true;
					button2.isEnabled = false;
					button2.isVisible = false;
					ballCam2.isVisible = true;
					ballCam1.isVisible = false;
					//hardMeshes[4].isVisible = !hardMeshes[4].isVisible;
							
					});
					
					
					button3.onPointerUpObservable.add(function() {
					//chooseMaze();
					if (meshFlag === 1){
					
					easyMeshes[3].isVisible = !easyMeshes[3].isVisible;
					
					}
					else {
					
					hardMeshes[3].isVisible = !hardMeshes[3].isVisible;
					
					}
						
					});
					
					button4.onPointerUpObservable.add(function() {
					
						myScene.activeCamera.detachControl(canvas);
						
						if (meshFlag === 1){
							myScene.activeCamera = myCamera1;
							myScene.activeCamera.attachControl(canvas);
							console.log("Case = " + meshFlag);
							//button4.isEnabled = false;
							//button4.isVisible = false;
						
						}
						else {
					
							//hardMeshes[3].isVisible = !hardMeshes[3].isVisible;
							myScene.activeCamera = myCamera2;
							myScene.activeCamera.attachControl(canvas);
							console.log("Case = " + meshFlag);
						}
						button4.isEnabled = false;
						button4.isVisible = false;
						button5.isEnabled = true;
						button5.isVisible = true;
						
						isPlay = 1;
						console.log(isPlay)
					});
					
					button5.onPointerUpObservable.add(function() {
						console.log("button 5 clicked " + meshFlag);
						myScene.activeCamera = myCamera3;
						myScene.activeCamera.attachControl(canvas);
						button4.isEnabled = true;
						button4.isVisible = true;
						button5.isEnabled = false;
						button5.isVisible = false;
						isPlay = 0;
						
					});
					
					
					//get total meshes and vertices
					var vertTotal = 0;
					allMeshes = myScene.meshes;
					divAllMeshs.innerHTML = allMeshes.length + " Total meshes";
					for (var i=0; i<allMeshes.length; i++){
						if (allMeshes[i].getTotalVertices() > 0){
							vertTotal = vertTotal + allMeshes[i].getTotalVertices()
						}
					}
					divVerts.innerHTML = vertTotal + " Total vertices";
					
					
                    // Once the scene is loaded, just register a render loop to render it
                    engine.runRenderLoop(function() {
						divFps.innerHTML = engine.getFps().toFixed() + " fps";
						divDCs.innerHTML = sceneInstru.drawCallsCounter.current.toString() + " DCs";
						//console.log(myCamera1.position)
                        myScene.render();
                    });
                });
            };
			//);
        //}

		
		

		
        window.addEventListener("resize", function () {
            engine.resize();
        });
		
		function chooseMaze(){
			switch(meshFlag){
			
			case 1 :
				meshFlag = 2;
				for(i=0; i<easyMeshes.length; i++){
				
					easyMeshes[i].setEnabled(false);
					hardMeshes[i].setEnabled(true);
					//console.log(easyMeshes[i].name + "   " + hardMeshes[i].name);
				};
				if(isPlay === 1){
					myScene.activeCamera.detachControl(canvas);
					myScene.activeCamera = myCamera1;
					myScene.activeCamera.attachControl(canvas);
					
				};	
				break;
				
			case 2 :
				meshFlag = 1;
				//meshFlag = 2;
				for(i=0; i<easyMeshes.length; i++){
				
					easyMeshes[i].setEnabled(true);
					hardMeshes[i].setEnabled(false);
					//console.log(easyMeshes[i].name + "   " + hardMeshes[i].name);
				};
				if(isPlay === 1){
					myScene.activeCamera.detachControl(canvas);
					myScene.activeCamera = myCamera1;
					myScene.activeCamera.attachControl(canvas);
					
				};	
				
				
				//easyMeshes[4].isVisible = !easyMeshes[4].isVisible;
		/*		
				button1.isEnabled = true;
				button1.isVisible = true;
				button2.isEnabled = false;
				button2.isVisible = falkse;
		*/
				break;
			
			default :
				break;
			
			};
		}
		
    </script>
</body>
</html>